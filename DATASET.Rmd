---
title: "Dataset"
author: "Hoik Jang"
date: '2018 11 20 '
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("RMySQL")
library(RSQLite)
library(RMySQL)
library(plyr)
```


```{r}
dcon <- dbConnect(SQLite(), dbname ="D:/RDATA/reddit_db.db")
dbListTables(dcon)

res <- dbSendQuery(conn = dcon, "
SELECT subredditname
FROM subreddits100
;")
list <- dbFetch(res, 100)
list$count<-0
dbClearResult(res)
maxnum1<-1483228800
maxnum2<-0
countnum<-0

while(maxnum1>maxnum2){
  maxnum2<-maxnum1
query <- paste0("
SELECT created_utc, subreddit,author
FROM RC17_01
WHERE created_utc>",maxnum2,"
LIMIT 1000000
;")
res<-dbSendQuery(dcon, query)
subdata<-as.data.frame(dbFetch(res, -1))
dbClearResult(res)
maxnum1<-max(subdata$created_utc)

for (i in c(list$subredditname)){
countlist<-table(c(subdata$subreddit))
countnum<-countlist[names(countlist)==i][[1]]
num<-as.numeric(which(list$subredditname==i))
list$count[[num]]<-list$count[[num]]+countnum
countnum<-0
}

}
list

res<-dbSendQuery(dcon, query)
list$count1 <- dbFetch(res, 100)
dbClearResult(res)

table<-as.data.frame(list)

for (i in c(list2$subreddit)){
query<-paste0("SELECT count(*) as count FROM (SELECT author
FROM RC17_01
WHERE subreddit='AskReddit') as a
INNER JOIN
(SELECT author
FROM RC17_01
WHERE subreddit='",i,"') as b
ON a.author=b.author
;'")
res<-dbSendQuery(dcon, query)
count<-dbFetch(res, -1)
dbClearResult(res)
num<-as.numeric(which(list$subreddit==i))
list$correlation[[num]]<-round(as.numeric(count/(list$count[[num]]*list$count[[1]]))*1000,digits=2)
}

list
```

